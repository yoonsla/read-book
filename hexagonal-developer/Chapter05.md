# 응집도와 결합도

설계, 패턴, 아키텍처등을 공부하다 보면 다음 2가지 용어를 자주 만나게 된다.

- 응집도(Cohesion)
- 결합도(Coupling)

좋은 코드, 좋은 설계, 패턴, 아키텍처는 높은 응집도와 낮은 결합도를 추구한다.

## 응집도

> 응집도는 모듈 안에 있는 요소가 함게 모여 있는 정도를 나타낸다.
> 응집도는 한 모듈의 파트가 동일한 모듈 안에 얼마나 포함되어 있는지를 나타낸다.

관련 코드가 한 곳에 모여 있으면 응집도가 높다고 표현하고 반대로 관련 코드가 여러 곳에 분산되어 있으면 응집도가 낮다고 표현한다.

메서드 추출을 잘 활용하면 코드 가독성을 높이면서 응집도도 함께 높일 수 있다.

그렇다면 왜 응집도를 높여야할까?

응집도는 수정 비용과 관련이 있다.
응집도가 높으면 관련 코드가 한곳에 모여 있게 되고 관련되지 않은 코드는 포함하지 않는다.
역할에 따라 클래스가 분리되면서 자연스럽게 클래스 길이가 줄고, 메서드 단위로 작성하기 때문에 가독성이 좋아진다.
따라서 코드 분석 시간을 줄여준다.

응집도가 높아지면 기능을 변경할 때 수정할 범위도 줄어든다.
한 클래스만 수정하거나 한 메서드만 수정하는 식.

### 응집도 • 역할 • 수정 범위

응집도가 높아지면 구성 요소가 역할에 따라 분리될 가능성이 커진다.
구성 요소가 역할에 따라 분리될수록 소프트웨어를 수정해야 할 때 변경 범위가 좁아진다.
또한 응집도가 높아질수록 구성 요소를 수정하려는 이유도 하나로 줄어든다.

### 캡슐화와 응집도

객체지향에서 캡슐화는 데이터와 함수를 한곳에 모은다.
흔히 말하는 캡슐화는 정보 은닉을 포함한다.

캡슐화는 응집도를 높이는 방법의 하나다.
객체 지향헤서 캡슐화는 데이터에 대한 직접 접근을 최소화해서 구현을 감추고 외부에 기능을 제공한다.  
이렇게 하면 구현을 변경해야 할 때 수정 범위가 캡슐화한 객체로 좁혀진다.

## 결합도

> 결합도는 소프트웨어 모듈이 서로 의존하는 정도이다.
> 두 모듈이 얼마나 밀접하게 연결되어 있는지 모듈 간 관계 정도를 나타낸다.

한 요소를 수정할 때 다른 요소도 함께 수정해야 하면 두 요소 간 결합도가 높다고 표현한다.
반대로 한 모듈을 수정할 때 다른 모듈을 수정하지 않아도 되면 결합도가 낮다고 말한다.

즉, 결합도가 높아지면 유지보수 비용이 증가한다.
따라서 수정 비용을 낮추기 위해서는 응집도는 높이고 결합도는 낮춰야 한다.

응집도를 높이고 결합도를 낮추려면 구성 요소 간 상호 작용을 최소화해야 한다.
구성 요소 간 상호 작용을 최소화하려면 구현에 대한 의존을 줄이는 것이 중요하다.  
앞서 언급한 캡슐화는 구현을 감춤으로써 두 구성 요소 간의 상호 작용을 줄여주어 응집도는 높이고 결합도는 낮춰준다.

### 추상화 타입과 결합도

추상화 타입을 사용해도 결합도를 낮출 수 있다.

구현에 직접 의존하게 되면 요구사항이 변경됐을 때 구현에 의존한 클래스 역시 함께 변경을 해야 한다.
이러한 경우에 추상화를 통해 강결합을 낮출 수 있다.

### 이벤트와 결합도

결합도를 낮추는 또 다른 방법은 이벤트를 사용하는 것이다.
이벤트를 발행하는 코드와 이벤트를 구독하는 코드가 분리되기 때문에 더이상 서로 의존을 하지 않는다.  
이처럼 이벤트를 사용하면 결합을 제거하고 응집도를 높일 수 있다.

### 추상화 • 이벤트 코드 추적

결합도를 낮추기 위해 추상화 타입을 중간에 위치시키거나 이벤트를 사용하면 두 코드를 직접 연결하지 않고 간접적으로 연결하게 된다.
새로운 타입이 추가되어 구조도 약간 복잡해진다.
따라서 추상화나 이벤트를 적용할 때는 결합도 감소, 응집도 증가, 변경 비용 감소, 테스트 가능성 등 얻을 수 있는 이점을 따져봐야 한다.

이점이 별로 없다면 추상화 타입을 사용하지 않고 구현만 분리해서 응집도를 높이는 것도 좋은 선택이 될 수 있다.

### 결합 유형

결합은 다양한 형태로 존재한다.  
어떤 형태의 결합이 존재하는지 알면 결합도를 높이지 않는 방향으로 코드를 작성하는 데 도움이 된다.

#### 공통 결합

여러 모듈이 동일한 글로벌 데이터에 접근할 때 발생한다.
여러 기능이 글로벌 데이터에 직접 접근하기 때문에 글로벌 데이터에서 변경이 발생하면 예측하기 힘든 문제가 생길 수 있다.

공통 결합은 데이터의 의미나 속성이 바뀌면 많은 모듈에 영향을 준다.

#### 하위 클래스 결합

하위 클래스와 상위 클래스 간의 관계를 설명한다.
하위 클래스가 상위 클래스에 의존하고 상위 클래스는 하위 클래스에 의존하지 않는다.
하지만 상위 클래스 기능을 사용하는 하위 클래스가 많을수록 상위 클래스를 수정하기 어려워진다.

#### 시간적 결합

단지 함께 실행해야 하므로 두 기능을 한 모듈에 묶을 때 발생한다.
이런 형태의 결합은 추상화나 이벤트 같은 방법으로 결합을 낮출 수 있다.  
지켜야 하는 실행 순서도 시간적 결합에 해당한다.

#### 논리 결합 or 변경 결합

두 모듈 간의 변경 패턴이 존재할 때 발생한다.
모듈, 시스템 데이터를 변경할 때 다른 모듈, 시스템 데이터도 함께 변경해야 한다면 논리 결합이 발생한다.





















